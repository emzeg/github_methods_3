---
title: "practical_exercise_2, Methods 3, 2021, autumn semester"
author: '[FILL IN YOUR NAME]'
date: "[FILL IN THE DATE]"
output: pdf_document
---

<style type="text/css">
  body{
  font-size: 14pt;
}
</style>

```{r setup, include=FALSE}
setwd("~/methods 3/Methods 3/Methods-3/github_methods_3-main/github_methods_3-main/week_02")
knitr::opts_chunk$set(echo = TRUE)
```

# Assignment 1: Using mixed effects modelling to model hierarchical data
In this assignment we will be investigating the _politeness_ dataset of Winter and Grawunder (2012) and apply basic methods of multilevel modelling. 

## Dataset
The dataset has been shared on GitHub, so make sure that the csv-file is on your current path. Otherwise you can supply the full path.

```{r}
setwd("~/methods 3/Methods 3/Methods-3/github_methods_3-main/github_methods_3-main/week_02")

pacman::p_load(tidyverse, jpeg, grid, ggpubr, ggrepel, lme4)
politeness <- read.csv("politeness.csv") 
```

# Exercises and objectives
The objectives of the exercises of this assignment are:  
1) Learning to recognize hierarchical structures within datasets and describing them  
2) Creating simple multilevel models and assessing their fitness  
3) Write up a report about the findings of the study  

REMEMBER: In your report, make sure to include code that can reproduce the answers requested in the exercises below  
REMEMBER: This assignment will be part of your final portfolio

## Exercise 1 - describing the dataset and making some initial plots

1) Describe the dataset, such that someone who happened upon this dataset could understand the variables and what they contain  
   
   Answer: 
   The subject is the ID for the participant, and also corresponds to gender, so that all females are given an "F" in front of      their associated number, and males an "M" to easily discern which gender the participants are when working with the              data. Gender is their gender. Scenario is which condition they are in, as in they are given a situation, or, "scenario" in       which they must speak. Attitude is whether they are speaking formally(pol = polite) or informally (inf). Total_duration refers    to the total amount of time they were speaking. F0mn refers to the mean pitch (Hz) of the subject speaking. The hiss_count is    the amount of times they make a "hissing" or "sss" noise (tends to occur more when speaking formally).
   
    i. Also consider whether any of the variables in _politeness_ should be encoded as factors or have the factor encoding removed. Hint: ```?factor```  
    
```{r}
head(politeness)

?factor

politeness$gender <- as.factor(politeness$gender)
politeness$scenario <- as.factor(politeness$scenario)
politeness$attitude <- as.factor(politeness$attitude)
class(politeness$total_duration)
class(politeness$f0mn)
class(politeness$hiss_count)
class(politeness$subject)
```

2) Create a new data frame that just contains the subject _F1_ and run two linear models; one that expresses _f0mn_ as dependent on _scenario_ as an integer; and one that expresses _f0mn_ as dependent on _scenario_ encoded as a factor  
```{r}
F1_bby <- subset(politeness, subject == "F1")



M1 <- lm(f0mn ~ as.integer(F1_bby$scenario), data = F1_bby)

M2 <- lm(f0mn ~ as.factor(F1_bby$scenario), data = F1_bby)

M1
M2
```


    i. Include the model matrices, $X$ from the General Linear Model, for these two models in your report and describe the different interpretations of _scenario_ that these entail
```{r}
mx1 <- model.matrix(M1)
mx2 <- model.matrix(M2)


```

    ii. Which coding of _scenario_, as a factor or not, is more fitting?
```{r}
#as a factor???
```

3) Make a plot that includes a subplot for each subject that has _scenario_ on the x-axis and _f0mn_ on the y-axis and where points are colour coded according to _attitude_

```{r}
politeness %>%
  ggplot(aes(scenario, f0mn, colour = attitude)) + geom_point() + facet_wrap("subject")

```

    i. Describe the differences between subjects 
    
    Answer: It would seem that everyone tht is in the "F" category has higher an average higher pitch mean than those are are in the "M" category of subjects. By looking at the dataframe we can see that all participants that have been assigned an F are female, and M male, which then from purely looking at the visualisations, we can see that women speak with higher pitch in both formal and informal situations than males.The males data seem to follow a trend with largely only M4 who has a bit more randomness in his data points. In the females, both F9 and F5 have randomness in their data points. F4 was also the only female to have avg. Hz go beneath 150. In the male group, none had an average go to/or over 250. Overall, from purely looking at the data it would seem that subjects speak in a higher tone/a higher average Hz level when they are speaking informally rather than politely. There doesn't seem to be a particular scenario that results in an overall change of pitch, though scenario 4 is the closest to being one where most participants experience an overall rise in mean Hz regardless of attitude.

    
          
    
## Exercise 2  - comparison of models

For this part, make sure to have `lme4` installed.  
You can install it using `install.packages("lme4")` and load it using `library(lme4)`  
`lmer` is used for multilevel modelling

```{r, eval=FALSE}
mixed.model <- lmer(formula=..., data=...)
example.formula <- formula(dep.variable ~ first.level.variable + (1 | second.level.variable))
```

1) Build four models and do some comparisons

    i. a single level model that models _f0mn_ as dependent on _gender_
```{r}

```

    ii. a two-level model that adds a second level on top of i. where unique intercepts are modelled for each _scenario_
```{r}

```

    iii. a two-level model that only has _subject_ as an intercept 
```{r}

```

    iv. a two-level model that models intercepts for both _scenario_ and _subject_
```{r}

```

    v. which of the models has the lowest residual standard deviation, also compare the Akaike Information Criterion `AIC`?
```{r}

```

    vi. which of the second-level effects explains the most variance?
```{r}

```

2) Why is our single-level model bad?
because it doesnt acount for any variance?????


    i. create a new data frame that has three variables, _subject_, _gender_ and _f0mn_, where _f0mn_ is the average of all responses of each subject, i.e. averaging across _attitude_ and_scenario_
```{r}

```

    ii. build a single-level model that models _f0mn_ as dependent on _gender_ using this new dataset
```{r}

```

    iii. make Quantile-Quantile plots, comparing theoretical quantiles to the sample quantiles) using `qqnorm` and `qqline` for the new single-level model and compare it to the old single-level model (from 1).i). Which model's residuals ($\epsilon$) fulfil the assumptions of the General Linear Model better?)
```{r}

```

    iv. Also make a quantile-quantile plot for the residuals of the  multilevel model with two intercepts. Does it look alright?
```{r}

```

3) Plotting the two-intercepts model
    i. Create a plot for each subject, (similar to part 3 in Exercise 1), this time also indicating the fitted value for each of the subjects for each for the scenarios (hint use `fixef` to get the "grand effects" for each gender and `ranef` to get the subject- and scenario-specific effects)
```{r}

```

    
## Exercise 3 - now with attitude

1) Carry on with the model with the two unique intercepts fitted (_scenario_ and _subject_).
```{r}

```

    i. now build a model that has _attitude_ as a main effect besides _gender_
```{r}

```

    ii. make a separate model that besides the main effects of _attitude_ and _gender_ also include their interaction
```{r}

```

    iii. describe what the interaction term in the model says about Korean men's pitch when they are polite relative to Korean women's pitch when they are polite (you don't have to judge whether it is interesting)  
```{r}

```

2) Compare the three models (1. gender as a main effect; 2. gender and attitude as main effects; 3. gender and attitude as main effects and the interaction between them. For all three models model unique intercepts for _subject_ and _scenario_) using residual variance, residual standard deviation and AIC.  
```{r}

```

3)  Choose the model that you think describe the data the best - and write a short report on the main findings based on this model. At least include the following:
  i. describe what the dataset consists of
  
  Answer: 
  The dataset consists of 224 observations of 7 variables; Subject, Gender, Scenario, Attitude, Total_duration, f0mn and           hiss_count. This data comes from an experiment to observe mean Hz changes in Koreans when speaking formally vs informally.       Description of these variables follows:
  
   The subject is the ID for the participant, and also corresponds to gender, so that all females are given an "F" in front of      their associated number, and males an "M" to easily discern which gender the participants are when working with the              data. Gender is their gender. Scenario is which condition they are in, as in they are given a situation, or, "scenario" in       which they must speak. Attitude is whether they are speaking formally(pol = polite) or informally (inf). Total_duration refers    to the total amount of time they were speaking. F0mn refers to the mean pitch (Hz) of the subject speaking. The hiss_count is    the amount of times they make a "hissing" or "sss" noise (tends to occur more when speaking formally).

  ii. what can you conclude about the effect of gender and attitude on pitch (if anything)? 
```{r}

```

  iii. motivate why you would include separate intercepts for subjects and scenarios (if you think they should be included) 

Subjects and scenarios should have different intercepts because it would be assumed they would all have different baselines, (and therefore need different intercepts to account for this). Different subjects will naturally already speak at a different pitch level, so separate intercepts allows us to account for these differences. The different scenarios may also need separate intercepts as certain scenarios may result in participants lowering or raising their pitch to meet the appropriate ambiance of the scenario. Once again, by including separate intercepts for scenarios then we should be accounting for these differences in our models. 


  iv. describe the variance components of the second level (if any)  
```{r}

```

  v. include a Quantile-Quantile plot of your chosen model  
```{r}

```





